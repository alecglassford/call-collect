<div>
  <ProjectInfo :currentProject :currentPrompts :currentSubmissions/>
  <Submissions :currentProject :currentPrompts :currentSubmissions/>
</div>

<style>
  div {
    flex-grow: 1;
    background-color: #FBFCFC;
    padding: 1em;
    display: flex;
    flex-direction: column;
  }
</style>

<script>
  import ProjectInfo from './ProjectInfo.html';
  import Submissions from './Submissions.html';

  export default {
    components: { ProjectInfo, Submissions },
    data() {
      return {
        currentProject: null,
        currentPrompts: null,
        currentSubmissions: null,
      };
    },
    computed: {
      uriName: (currentProject) => {
        if (!currentProject || currentProject === 'new') return null;
        return encodeURIComponent(currentProject.fields.name);
      },
    },
    oncreate() {
      const match = this.get('match');
      const projects = this.store.get('projectList');
      const currentProject = projects
        .find(p => p.id === match.params.slug);
      this.set({ currentProject });
      const fetchPrompts = () => {
        this.set({ currentPrompts: null });
        const name = this.get('uriName');
        fetch(`/api/prompts/${name}`).then(res => res.json())
          .then((currentPrompts) => {
            this.set({ currentPrompts });
          });
      };
      const fetchSubmissions = () => {
        this.set({ currentSubmissions: null });
        const name = this.get('uriName');
        fetch(`/api/submissions/${name}`).then(res => res.json())
          .then((currentSubmissions) => {
            this.set({ currentSubmissions });
          });
      };
      fetchPrompts();
      fetchSubmissions();
      this.observe('currentProject', () => {
        fetchPrompts();
        fetchSubmissions();
      });
    },
  };
</script>
