{{#if state === 'UNTOUCHED'}}
  <button on:click="start()" class="btn btn-primary mt-3">âž• Add prompt</button>
{{elseif state === 'STARTED'}}
  <div class="mt-3 border p-3">
    <label for="slug">Write a short slug for your prompt:</label>
    <input id="slug" type="text" bind:value="slug" class="form-control">

    <label for="audio">Upload your prompt as a .wav file: </label>
    <input id="audio" type="file" accept="audio/*" on:change="loadAudio(this.files[0])"
      class="form-control form-control-file {{invalid?'is-invalid':''}}">
    <p class="invalid-feedback">You must upload an audio file.</p>

    <button on:click="uploadPrompt()" class="btn btn-success mt-3">Submit slug and audio</button>
  </div>
{{else}}
  <Spinner/>
{{/if}}

<script>
  import Spinner from './Spinner.html';

  export default {
    components: { Spinner },
    methods: {
      start() {
        this.set({ state: 'STARTED' });
      },
      loadAudio(file) {
        this.set({ file });
      },
      uploadPrompt() {
        console.log('wut');
        // eslint-disable-next-line object-curly-newline
        const { projectId, index, slug, file } = this.get();
        if (!file) {
          this.set({ invalid: true });
          console.log('yo');
          return;
        }
        this.set({ state: 'UPLOADING' });
        const fd = new FormData();
        fd.append('projectId', projectId);
        fd.append('index', index);
        fd.append('slug', slug);
        fd.append('promptAudio', file);
        fetch('/api/prompts', {
          method: 'POST',
          body: fd,
        }).then(() => {
          this.fire('refreshPrompts', {});
        });
      },
    },
    data() {
      return {
        state: 'UNTOUCHED',
        invalid: false,
        projectId: null,
        index: -1, // this ... shouldn't happen
        slug: '',
        file: null,
      };
    },
    oncreate() {
      this.observe('index', () => { // Detects when successfully uploaded prompt
        this.set({ invalid: false, state: 'UNTOUCHED' });
      });
    },
  };
</script>
