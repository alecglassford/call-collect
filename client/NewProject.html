<div>
  <h2>Create a new project</h2>

  {{#if !creating}}
    <h3>What do you want to call your project?</h3>
    <input type="text" bind:value="name">
    <h3>Add a description</h3>
    <textarea bind:value="description"></textarea>
    <button id="create" on:click="createProject()">ðŸš‚ Create project</button>
  {{else}}
    {{#if !project}}
      <p>Creating project record â€¦ <span class="loading"></span></p>
    {{else}}
      <p>Your new project, {{name}}, was successfully created! âœ…</p>
      <p>It was assigned the phone number {{humanPhone(project.fields.phone)}}.</p>
      <p>Visit <Link to="/project/{{project.id}}">the project page</Link> to add prompts.</p>
    {{/if}}
  {{/if}}
</div>

<style>
  div {
    margin: 0 auto;
    max-width: 30em;
    display: flex;
    flex-direction: column;
  }

  input[type="text"] {
    font-size: 1.5em;
    outline: none;
  }

  .loading {
		display: inline-block;
    margin-left: 1em;
    border: 2px solid #ddd;
    border-top: 2px solid blue;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  #create {
    margin: 2em auto;
    width: 50%;
    height: 5em;
  }
</style>

<script>
  import Link from 'svelte-routing/Link.html';

  import { humanPhone } from './util';

  export default {
    components: { Link },
    helpers: { humanPhone },
    methods: {
      createProject() {
        this.set({ creating: true });
        const { name, description } = this.get();
        fetch('/api/projects', {
          method: 'POST',
          body: JSON.stringify({ name, description }),
          headers: new Headers({ 'Content-Type': 'application/json' }),
        }).then(res => res.json()).then((project) => {
          this.set({ project });
          this.store.set({
            projectList: fetch('/api/projects').then(res => res.json()),
          });
        });
      },
    },
    data() {
      return {
        name: '',
        description: '',
        project: null,
        creating: false,
      };
    },
  };
</script>
