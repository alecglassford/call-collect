<div id="new-project" class="mx-auto text-center">
  <h2 class="display-4 serif">Create a new project</h2>
  {{#if !creating}}
    <label for="project-name"><h3>What do you want to call your project?</h3></label>
    <input type="text" bind:value="name" class="form-control {{invalid?'is-invalid':''}}" id="project-name">
    <p class="invalid-feedback">Please enter a name.</p>

    <label for="project-desc"><h3>Add a description</h3></label>
    <textarea bind:value="description" class="form-control" id="project-desc"></textarea>

    <button class="mt-3 btn btn-primary" on:click="createProject()">ðŸš‚ Create project</button>
  {{else}}
    {{#if !project}}
      <p>Creating project record â€¦ <Spinner/></p>
    {{else}}
      <p>Your new project, {{name}}, was successfully created! âœ…</p>
      <p>It was assigned the phone number {{humanPhone(project.fields.phone)}}.</p>
      <p>Visit <Link to="/project/{{project.id}}">the project page</Link> to add prompts.</p>
    {{/if}}
  {{/if}}
</div>

<style>
  #new-project {
    max-width: 720px;
  }
</style>

<script>
  import Link from 'svelte-routing/Link.html';

  import { humanPhone } from './util';
  import Spinner from './Spinner.html';

  export default {
    components: { Link, Spinner },
    helpers: { humanPhone },
    methods: {
      createProject() {
        const { name, description } = this.get();
        if (!name) {
          this.set({ invalid: true });
          return;
        }
        this.set({ creating: true });
        fetch('/api/projects', {
          method: 'POST',
          body: JSON.stringify({ name, description }),
          headers: new Headers({ 'Content-Type': 'application/json' }),
        }).then(res => res.json()).then((project) => {
          this.set({ project });
          this.store.set({
            projectList: fetch('/api/projects').then(res => res.json()),
          });
        });
      },
    },
    data() {
      return {
        name: '',
        description: '',
        invalid: false,
        project: null,
        creating: false,
      };
    },
  };
</script>
